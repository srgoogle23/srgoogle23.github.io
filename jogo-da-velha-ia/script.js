var cv=document.getElementById("cv"),context=cv.getContext("2d"),d=100;function drawLine(t,e){context.beginPath(),context.moveTo(t[0],t[1]),context.lineTo(e[0],e[1]),context.lineWidth=5,context.strokeStyle="#000000",context.stroke()}function drawColorLine(t,e,r){context.beginPath(),context.moveTo(t[0],t[1]),context.lineTo(e[0],e[1]),context.lineWidth=2,context.strokeStyle=r,context.stroke()}function drawCircle(t,e){context.beginPath(),context.ellipse(t[0],t[1],e,e,Math.PI/4,0,2*Math.PI),context.stroke()}function drawGrid(){context.beginPath(),context.fillStyle="#FFFFFF",context.fillRect(0,0,3*d,3*d),context.stroke();for(var t=0;t<=3;t++){var e=t*d;drawLine([e,0],[e,3*d])}for(var r=0;r<=3;r++){var n=r*d;drawLine([0,n],[3*d,n])}}function drawX(t,e){var r=t*d,n=e*d,o=(t+1)*d,a=(e+1)*d;drawLine([r+20,n+20],[o-20,a-20]),drawLine([o-20,n+20],[r+20,a-20])}function drawO(t,e){drawCircle([t*d+d/2,e*d+d/2],30)}function resetGrid(){drawGrid()}var currentState=[["","",""],["","",""],["","",""]],gameReseted=!1,gameEnd=!1;function stateIsFull(t){for(var e=0;e<3;e++)for(var r=0;r<3;r++)if(""==t[e][r])return!1;return!0}function resetGame(){currentState=[["","",""],["","",""],["","",""]],gameReseted=!0,gameEnd=!1,resetGrid()}function forEachGap(t,e){for(var r=0;r<3;r++)for(var n=0;n<3;n++)""==t[r][n]&&e(r,n)}function cloneState(t){for(var e=[["","",""],["","",""],["","",""]],r=0;r<3;r++)for(var n=0;n<3;n++)e[r][n]=t[r][n];return e}function stateX(t,e,r){var n=cloneState(t);return n[e][r]="x",n}function stateO(t,e,r){var n=cloneState(t);return n[e][r]="o",n}function drawState(t){resetGrid();for(var e=0;e<3;e++)for(var r=0;r<3;r++)"x"==t[e][r]?drawX(e,r):"o"==t[e][r]&&drawO(e,r)}function whoWin(t){if("o"==t[0][0]&&"o"==t[1][1]&&"o"==t[2][2])return"o";if("o"==t[2][0]&&"o"==t[1][1]&&"o"==t[0][2])return"o";for(var e=0;e<3;e++)if("o"==t[e][0]&&"o"==t[e][1]&&"o"==t[e][2])return"o";for(var r=0;r<3;r++)if("o"==t[0][r]&&"o"==t[1][r]&&"o"==t[2][r])return"o";if("x"==t[0][0]&&"x"==t[1][1]&&"x"==t[2][2])return"x";if("x"==t[2][0]&&"x"==t[1][1]&&"x"==t[0][2])return"x";for(e=0;e<3;e++)if("x"==t[e][0]&&"x"==t[e][1]&&"x"==t[e][2])return"x";for(r=0;r<3;r++)if("x"==t[0][r]&&"x"==t[1][r]&&"x"==t[2][r])return"x";return""}function detectEnd(){("o"==currentState[0][0]&&"o"==currentState[1][1]&&"o"==currentState[2][2]||"x"==currentState[0][0]&&"x"==currentState[1][1]&&"x"==currentState[2][2])&&(console.log("line formed in main diagonal"),gameEnd=!0,drawColorLine([0,0],[3*d,3*d],"#FF0000")),("o"==currentState[2][0]&&"o"==currentState[1][1]&&"o"==currentState[0][2]||"x"==currentState[2][0]&&"x"==currentState[1][1]&&"x"==currentState[0][2])&&(console.log("line formed in secondary diagonal"),gameEnd=!0,drawColorLine([3*d,0],[0,3*d],"#FF0000"));for(var t=0;t<3;t++)("x"==currentState[t][0]&&"x"==currentState[t][1]&&"x"==currentState[t][2]||"o"==currentState[t][0]&&"o"==currentState[t][1]&&"o"==currentState[t][2])&&(console.log("line formed in column="+t),gameEnd=!0,drawColorLine([d*t+d/2,0],[d*t+d/2,3*d],"#FF0000"));for(var e=0;e<3;e++)("x"==currentState[0][e]&&"x"==currentState[1][e]&&"x"==currentState[2][e]||"o"==currentState[0][e]&&"o"==currentState[1][e]&&"o"==currentState[2][e])&&(console.log("line formed in line="+e),gameEnd=!0,drawColorLine([0,d*e+d/2],[3*d,d*e+d/2],"#FF0000"));1==stateIsFull(currentState)&&(console.log("all gaps were filled"),gameEnd=!0)}const playerO=!1,playerX=!0;function minmax(t,e){var r=whoWin(t);if(""!=r||stateIsFull(t))return""==r?[0,NaN,NaN]:"x"==r?[1,NaN,NaN]:[-1,NaN,NaN];if(e==playerO){var n=-2;return forEachGap(t,function(r,c){var d;[d,NaN,NaN]=minmax(stateX(t,r,c),!e),d>n&&([n,o,a]=[d,r,c])}),[n,o,a]}var o,a,c=2;return forEachGap(t,function(r,n){var d;[d,NaN,NaN]=minmax(stateO(t,r,n),!e),d<c&&([c,o,a]=[d,r,n])}),[c,o,a]}function bestX(t){var e,r;return[NaN,e,r]=minmax(t,playerO),[e,r]}function detectCL(t,e){return[t/d|0,e/d|0]}function randomMove(){do{xc=(100*Math.random()|0)%3,xl=(100*Math.random()|0)%3,console.log("loop:"+[xc,xl])}while(""!=currentState[xc][xl]);return console.log("AI randomly chose: "+[xc,xl]),[xc,xl]}var gameLocked=!1;cv.addEventListener("click",function(t){if(gameReseted=!1,1!=gameLocked)if(1!=gameEnd){var e,r,n=t.pageX-cv.offsetLeft,o=t.pageY-cv.offsetTop;if([e,r]=detectCL(n,o),""==currentState[e][r]){if(console.log("User chose: "+[e,r]),currentState[e][r]="o",drawState(currentState),detectEnd(),1==gameEnd)return;gameLocked=!0,setTimeout(function(){if(1!=gameReseted){var t=-1,e=-1;[t,e]=bestX(currentState),console.log("AI chose: "+[t,e]),-1!=t&&-1!=e?currentState[t][e]="x":([t,e]=randomMove(),currentState[t][e]="x"),drawState(currentState),detectEnd(),gameLocked=!1}},100)}}else alert("Game is over")});var resetButton=document.getElementById("resetButton");resetButton.addEventListener("click",resetGame),drawGrid();